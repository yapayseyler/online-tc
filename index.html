<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MRZ Okuyucu + Kayıt Görüntüleyici</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b0f14;color:#e6eef8}
    header{padding:14px 16px;border-bottom:1px solid #1f2733;background:#111827;position:sticky;top:0;z-index:50}
    header h1{margin:0;font-size:18px;color:#cfe1ff}
    main{display:grid;gap:20px;max-width:1200px;margin:0 auto;padding:16px}
    .panel{background:#171923;border:1px solid #2a3547;border-radius:14px;overflow:hidden}
    .panel h2{margin:0;padding:12px 14px;font-size:16px;color:#b9c8da;border-bottom:1px solid #2a3547}
    .content{padding:12px}
    video,#img{width:100%;border-radius:10px;background:#000}
    .mrz-window{position:absolute;left:5%;right:5%;height:26%;bottom:8%;border:2px dashed #58a6ff88;border-radius:8px;box-shadow:0 0 0 200vmax #0006 inset}
    #fields .kv{display:grid;grid-template-columns:140px 1fr;gap:6px;font-size:14px;padding:4px 0;border-bottom:1px dashed #2a3547}
    #fields b{color:#cfe1ff}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px}
    .btn-primary{background:#0d6efd;border:0;color:#fff}
    .btn-ghost{background:transparent;border:1px dashed #2a3547;color:#9bb0c9}
    .ok{color:#22c55e;font-weight:700}
    .bad{color:#ef4444;font-weight:700}
    .form{display:grid;gap:10px}
    .form label{display:grid;gap:4px;font-size:14px}
    .form input{padding:8px 10px;border-radius:8px;background:#111827;border:1px solid #2a3547;color:#fff}
    .error{font-size:12px;color:#ef4444}
    /* Görüntüleyici kısmı */
    .stats{display:flex;gap:20px;flex-wrap:wrap;margin:14px 0}
    .stat-card{background:#1a1f2e;padding:14px;border-radius:10px;min-width:120px;text-align:center}
    .stat-number{font-size:22px;font-weight:bold;color:#4f8cff}
    .stat-label{font-size:12px;color:#9aa0a6}
    .record-card{background:#1a1f2e;border-radius:10px;padding:14px;margin:10px 0;border-left:4px solid #4f8cff}
    .record-header{display:flex;justify-content:space-between;font-size:14px;color:#9aa0a6;margin-bottom:8px}
    .record-name{font-size:16px;font-weight:600;color:#fff}
    .detail-item{margin:4px 0}
    .detail-label{font-size:11px;color:#9aa0a6;text-transform:uppercase}
    .detail-value{font-size:14px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid #2a3547;text-align:left;font-size:14px}
    th{background:#1a1f2e;color:#4f8cff}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
<header>
  <h1>MRZ Okuyucu + Kayıt Görüntüleyici</h1>
</header>
<main>
  <!-- OCR Tarama Paneli -->
  <section class="panel">
    <h2>Kimlik Tara</h2>
    <div class="content">
      <div class="toolbar">
        <button id="btnOpen" class="btn-primary">Kamerayı Aç</button>
        <button id="btnStop" class="btn-ghost">Kapat</button>
        <button id="btnSnap" class="btn-primary">Tara</button>
        <input type="file" id="file" accept="image/*"/>
        <button id="btnOCR" class="btn-primary">Resmi Tara</button>
      </div>
      <video id="video" autoplay playsinline></video>
      <img id="img" style="display:none"/>
      <div class="mrz-window"></div>
      <pre id="rawText" style="background:#111827;padding:8px;border-radius:8px;max-height:120px;overflow:auto"></pre>
      <div id="fields"></div>
    </div>
  </section>
  
  <!-- Form Paneli -->
  <section class="panel">
    <h2>Alanları Düzenle</h2>
    <div class="content">
      <div class="form">
        <label>TCKN <input type="text" id="inpTCKN" maxlength="11"/></label>
        <span id="errTCKN" class="error"></span>
        <label>Doğum Tarihi <input type="date" id="inpDOB"/></label>
        <span id="errDOB" class="error"></span>
        <label>Ad <input type="text" id="inpName"/></label>
        <label>Soyad <input type="text" id="inpSurname"/></label>
      </div>
      <div class="toolbar">
        <button id="btnSave" class="btn-primary">Kaydet</button>
        <button id="btnClear" class="btn-ghost">Temizle</button>
        <span id="validityTag">Geçerlilik: —</span>
      </div>
    </div>
  </section>
  
  <!-- Görüntüleyici Paneli -->
  <section class="panel">
    <h2>Kayıtlar</h2>
    <div class="content">
      <div class="stats">
        <div class="stat-card"><div id="totalRecords" class="stat-number">0</div><div class="stat-label">Toplam</div></div>
        <div class="stat-card"><div id="todayRecords" class="stat-number">0</div><div class="stat-label">Bugün</div></div>
      </div>
      <div id="cards"></div>
      <table>
        <thead><tr><th>#</th><th>TCKN</th><th>Ad Soyad</th><th>Doğum Tarihi</th><th>Zaman</th></tr></thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </section>
</main>

<script>
const STORAGE_KEY="mrzKayitlar";
const video=document.getElementById("video"),imgEl=document.getElementById("img"),rawText=document.getElementById("rawText"),fieldsEl=document.getElementById("fields");
const inpTCKN=document.getElementById("inpTCKN"),inpDOB=document.getElementById("inpDOB"),inpName=document.getElementById("inpName"),inpSurname=document.getElementById("inpSurname"),errTCKN=document.getElementById("errTCKN"),errDOB=document.getElementById("errDOB"),validityTag=document.getElementById("validityTag");
function validateTCKN(id){if(!/^[1-9]\\d{10}$/.test(id))return false;const d=id.split("").map(Number);const odd=d[0]+d[2]+d[4]+d[6]+d[8];const even=d[1]+d[3]+d[5]+d[7];const d10=((7*odd)-even)%10;const d11=d.slice(0,10).reduce((a,b)=>a+b,0)%10;return d10===d[9]&&d11===d[10];}
function validateDateISO(s){if(!s)return false;const d=new Date(s);return !isNaN(d);}
function validateForm(){let ok=true;if(!validateTCKN(inpTCKN.value)){errTCKN.textContent="Geçersiz TCKN";ok=false}else errTCKN.textContent="";if(!validateDateISO(inpDOB.value)){errDOB.textContent="Geçersiz tarih";ok=false}else errDOB.textContent="";validityTag.textContent="Geçerlilik: "+(ok?"Uygun":"Hatalı");return ok;}
function getFormData(){return{tckn:inpTCKN.value,ad:inpName.value,soyad:inpSurname.value,dob:inpDOB.value,timestamp:Date.now()};}
function loadStore(){return JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");}
function saveStore(arr){localStorage.setItem(STORAGE_KEY,JSON.stringify(arr));renderRecords();}
function renderRecords(){const data=loadStore();document.getElementById("totalRecords").textContent=data.length;const today=new Date();today.setHours(0,0,0,0);document.getElementById("todayRecords").textContent=data.filter(r=>{const d=new Date(r.timestamp);d.setHours(0,0,0,0);return d.getTime()===today.getTime();}).length;const cards=document.getElementById("cards"),tbody=document.getElementById("tableBody");cards.innerHTML="";tbody.innerHTML="";data.forEach((r,i)=>{const card=document.createElement("div");card.className="record-card";card.innerHTML=\`<div class="record-header"><div class="record-name">\${r.ad} \${r.soyad}</div><div>\${new Date(r.timestamp).toLocaleString("tr-TR")}</div></div><div class="detail-item"><span class="detail-label">TCKN</span><span class="detail-value">\${r.tckn}</span></div><div class="detail-item"><span class="detail-label">Doğum</span><span class="detail-value">\${r.dob}</span></div>\`;cards.appendChild(card);const row=tbody.insertRow();row.insertCell().textContent=i+1;row.insertCell().textContent=r.tckn;row.insertCell().textContent=r.ad+" "+r.soyad;row.insertCell().textContent=r.dob;row.insertCell().textContent=new Date(r.timestamp).toLocaleString("tr-TR");});}
document.getElementById("btnSave").onclick=()=>{if(!validateForm())return;const arr=loadStore();arr.push(getFormData());saveStore(arr);alert("Kayıt eklendi.");};
document.getElementById("btnClear").onclick=()=>{inpTCKN.value=inpDOB.value=inpName.value=inpSurname.value="";};
renderRecords();
</script>
</body>
</html>
